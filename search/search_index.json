{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"ISCO Pipeline","text":"<p>A cohesive training and inference pipeline for predicting ISCO-08 occupation codes from job titles and duty descriptions. The project bundles a command-line workflow for data preparation, model training, evaluation, and batch prediction, plus a FastAPI service for online scoring.</p>"},{"location":"#quick-start","title":"Quick Start","text":""},{"location":"#create-environment-install","title":"Create Environment &amp; Install","text":"<pre><code>python -m venv venv &amp;&amp; source venv/bin/activate\npip install -r requirements.txt\n</code></pre>"},{"location":"#prepare-data","title":"Prepare Data","text":"<p>Place your CSV under <code>data/raw/</code> (default name <code>historical_records.csv</code>) with <code>job_title</code>, <code>duties_description</code>, and <code>isco_code</code> columns.</p>"},{"location":"#run-full-pipeline","title":"Run Full Pipeline","text":"<pre><code>python main.py --config config.yaml\n</code></pre> <p>This runs preprocessing, trains a RoBERTa classifier, evaluates it, and writes artifacts to <code>data/processed/</code> and <code>models/</code>.</p>"},{"location":"#quick-prediction-only-run","title":"Quick Prediction-Only Run","text":"<p>Use the last promoted model:</p> <pre><code>python main.py --skip-training --input data/review/sample_jobs.csv --explain\n</code></pre> <p>Adds predictions and optional attention-based explanations to the input CSV.</p>"},{"location":"#api-usage","title":"API Usage","text":"<ol> <li> <p>Ensure the best model exists at <code>models/best_model/</code> (training updates this automatically when metrics improve).</p> </li> <li> <p>Start the API:    <pre><code>python api_server.py\n</code></pre>    The server listens on <code>http://localhost:8000</code> with interactive docs at <code>/docs</code>.</p> </li> <li> <p>Example single prediction request:    <pre><code>curl -X POST http://localhost:8000/predict/job \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"job_title\":\"Software Engineer\",\"duties_description\":\"Design and build backend services\"}'\n</code></pre></p> </li> </ol>"},{"location":"#repository-tour","title":"Repository Tour","text":"<ul> <li><code>main.py</code> \u2014 CLI entry point orchestrating preprocess \u2192 train \u2192 predict \u2192 evaluate.</li> <li><code>src/</code> \u2014 reusable modules (preprocessing, modeling, prediction, evaluation, utilities).</li> <li><code>api/</code> \u2014 FastAPI service, routers, and dependency wiring.</li> <li><code>models/</code> \u2014 timestamped checkpoints and the latest promoted model in <code>best_model/</code>.</li> <li><code>docs/</code> \u2014 supplementary guides for developers and operators.</li> </ul>"},{"location":"#next-steps","title":"Next Steps","text":"<ul> <li>User Guide \u2014 detailed walk-through for running training, evaluation, and predictions</li> <li>Developer Guide \u2014 architectural notes and development workflow</li> <li>Configuration Reference \u2014 comprehensive configuration options</li> <li>API Reference \u2014 API endpoints and usage examples</li> </ul>"},{"location":"api/","title":"API Reference","text":"<p>The ISCO Pipeline provides a FastAPI service for online prediction scoring.</p>"},{"location":"api/#starting-the-api","title":"Starting the API","text":"<pre><code>python api_server.py\n</code></pre> <p>The server listens on <code>http://localhost:8000</code> with interactive documentation at <code>/docs</code>.</p>"},{"location":"api/#endpoints","title":"Endpoints","text":""},{"location":"api/#single-job-prediction","title":"Single Job Prediction","text":"<p>POST <code>/predict/job</code></p> <p>Predict ISCO code for a single job.</p>"},{"location":"api/#request-body","title":"Request Body","text":"<pre><code>{\n  \"job_title\": \"Software Engineer\",\n  \"duties_description\": \"Design and build backend services\"\n}\n</code></pre>"},{"location":"api/#response","title":"Response","text":"<pre><code>{\n  \"job_title\": \"Software Engineer\",\n  \"duties_description\": \"Design and build backend services\",\n  \"predicted_code\": \"2512\",\n  \"predicted_occupation\": \"Software Developers\",\n  \"confidence\": 0.95,\n  \"confidence_grade\": \"very_high\",\n  \"is_fallback\": false,\n  \"alternatives\": [\n    {\n      \"code\": \"2511\",\n      \"occupation\": \"Systems Analysts\",\n      \"confidence\": 0.03\n    },\n    {\n      \"code\": \"2519\",\n      \"occupation\": \"Software and Applications Developers Not Elsewhere Classified\",\n      \"confidence\": 0.01\n    }\n  ]\n}\n</code></pre>"},{"location":"api/#example-curl","title":"Example cURL","text":"<pre><code>curl -X POST http://localhost:8000/predict/job \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"job_title\":\"Software Engineer\",\"duties_description\":\"Design and build backend services\"}'\n</code></pre>"},{"location":"api/#batch-prediction","title":"Batch Prediction","text":"<p>POST <code>/predict/batch</code></p> <p>Predict ISCO codes for multiple jobs in a single request.</p>"},{"location":"api/#request-body_1","title":"Request Body","text":"<pre><code>{\n  \"jobs\": [\n    {\n      \"job_title\": \"Software Engineer\",\n      \"duties_description\": \"Design and build backend services\"\n    },\n    {\n      \"job_title\": \"Data Scientist\",\n      \"duties_description\": \"Analyze data and build ML models\"\n    }\n  ]\n}\n</code></pre>"},{"location":"api/#response_1","title":"Response","text":"<p>Returns an array of prediction objects with the same structure as single predictions.</p>"},{"location":"api/#csv-upload-prediction","title":"CSV Upload Prediction","text":"<p>POST <code>/predict/csv</code></p> <p>Upload a CSV file and receive predictions for all rows.</p>"},{"location":"api/#request","title":"Request","text":"<ul> <li>Content-Type: <code>multipart/form-data</code></li> <li>Form field: <code>file</code> (CSV file)</li> <li>Required CSV columns: <code>job_title</code>, <code>duties_description</code></li> </ul>"},{"location":"api/#response_2","title":"Response","text":"<p>Returns a CSV file with the original data plus prediction columns: - <code>predicted_code</code> - <code>predicted_occupation</code> - <code>confidence</code> - <code>confidence_grade</code> - <code>is_fallback</code> - <code>alternative_1</code> / <code>_occupation</code> / <code>_confidence</code> (present when an alternative exists) - <code>alternative_2</code> / <code>_occupation</code> / <code>_confidence</code></p>"},{"location":"api/#example-curl_1","title":"Example cURL","text":"<pre><code>curl -X POST http://localhost:8000/predict/csv \\\n  -F \"file=@jobs.csv\" \\\n  -o predictions.csv\n</code></pre>"},{"location":"api/#response-fields","title":"Response Fields","text":"Field Type Description <code>job_title</code> string Original job title from the request <code>duties_description</code> string Original job description <code>predicted_code</code> string Predicted ISCO-08 code (4-digit or truncated to 3-digit on fallback) <code>predicted_occupation</code> string Human-readable occupation title sourced from the reference data <code>confidence</code> float Model confidence (0-1) <code>confidence_grade</code> string Bucketed confidence level (<code>very_low</code> \u2026 <code>very_high</code>) <code>is_fallback</code> boolean <code>true</code> when confidence is below the configured threshold <code>alternatives</code> array Up to two alternative predictions with <code>code</code>, <code>occupation</code>, and <code>confidence</code>"},{"location":"api/#model-caching","title":"Model Caching","text":"<p>The API uses an LRU cache for predictions, keyed by (job_title, duties_description) pairs. This improves response times for repeated queries.</p>"},{"location":"api/#configuration","title":"Configuration","text":"<p>The API loads the model from the path specified in <code>config.yaml</code>:</p> <pre><code>output:\n  best_model_dir: \"models/best_model\"\n</code></pre> <p>Confidence thresholds and other inference settings are also read from <code>config.yaml</code>:</p> <pre><code>model:\n  confidence_threshold: 0.1\n  max_seq_length: 256\n</code></pre>"},{"location":"api/#error-handling","title":"Error Handling","text":"<p>The API returns appropriate HTTP status codes:</p> <ul> <li>200 \u2014 Success</li> <li>400 \u2014 Bad request (invalid input format)</li> <li>422 \u2014 Validation error (missing required fields)</li> <li>500 \u2014 Internal server error (model loading or prediction failure)</li> </ul>"},{"location":"api/#interactive-documentation","title":"Interactive Documentation","text":"<p>Visit <code>http://localhost:8000/docs</code> for the auto-generated Swagger UI, where you can:</p> <ul> <li>Explore all available endpoints</li> <li>Test requests interactively</li> <li>View request/response schemas</li> <li>Download OpenAPI specification</li> </ul>"},{"location":"configuration/","title":"Configuration Reference","text":"<p>Key settings live in <code>config.yaml</code> and are grouped by concern.</p>"},{"location":"configuration/#data-configuration","title":"Data Configuration","text":"<p>File locations and preprocessing switches:</p> <ul> <li><code>raw_dir</code>, <code>processed_dir</code>, <code>corrections_dir</code>, <code>reference_dir</code> \u2014 directory roots for the pipeline stages.</li> <li><code>review_dir</code> \u2014 optional drop zone for exporting prediction review sets.</li> <li><code>validate_against_reference</code> \u2014 check predicted codes against the official lookup at <code>reference_file</code>.</li> <li><code>skip_clustering</code>, <code>skip_clustering_threshold</code> \u2014 control the optional embedding clustering used during preprocessing.</li> </ul>"},{"location":"configuration/#example","title":"Example","text":"<pre><code>data:\n  raw_dir: \"data/raw\"\n  processed_dir: \"data/processed\"\n  corrections_dir: \"data/corrections\"\n  reference_dir: \"data/reference\"\n  review_dir: \"data/review\"\n  validate_against_reference: true\n  skip_clustering: false\n  skip_clustering_threshold: 50000\n</code></pre>"},{"location":"configuration/#model-configuration","title":"Model Configuration","text":"<p>Architecture and inference behaviour:</p> <ul> <li><code>name</code> \u2014 Hugging Face model identifier (default <code>roberta-base</code>).</li> <li><code>max_seq_length</code> \u2014 maximum token length applied consistently across training and inference.</li> <li><code>batch_size</code>, <code>epochs</code>, <code>learning_rate</code> \u2014 training hyperparameters.</li> <li><code>confidence_threshold</code> \u2014 floor for accepting predictions; lower values yield more automatic predictions, higher values mark more rows as fallbacks.</li> <li><code>four_digit_only</code> \u2014 constrain labels to 4-digit ISCO codes.</li> </ul>"},{"location":"configuration/#example_1","title":"Example","text":"<pre><code>model:\n  name: \"roberta-base\"\n  max_seq_length: 256\n  batch_size: 16\n  epochs: 3\n  learning_rate: 2.0e-5\n  confidence_threshold: 0.1\n  four_digit_only: true\n</code></pre>"},{"location":"configuration/#training-configuration","title":"Training Configuration","text":"<p>Runtime controls for the Hugging Face trainer:</p> <ul> <li><code>enable_optimizations</code> \u2014 toggles gradient checkpointing/mixed precision (CUDA only).</li> <li><code>gradient_accumulation_steps</code> \u2014 multiplies effective batch size without increasing memory.</li> <li><code>evaluation_strategy</code>, <code>logging_steps</code> \u2014 frequency of validation and logging updates.</li> <li><code>early_stopping_patience</code> \u2014 number of evaluation rounds without improvement before halting; enables automatic best-model promotion.</li> <li><code>save_strategy</code>, <code>save_total_limit</code> \u2014 checkpoint cadence and retention.</li> <li><code>mps_*</code> keys \u2014 Apple Silicon-specific mixed-precision tuning.</li> </ul>"},{"location":"configuration/#example_2","title":"Example","text":"<pre><code>training:\n  enable_optimizations: true\n  gradient_accumulation_steps: 2\n  evaluation_strategy: \"epoch\"\n  logging_steps: 50\n  early_stopping_patience: 2\n  save_strategy: \"epoch\"\n  save_total_limit: 2\n  warmup_steps: 100\n  weight_decay: 0.01\n</code></pre>"},{"location":"configuration/#output-configuration","title":"Output Configuration","text":"<p>Destinations for checkpoints and the promoted model:</p> <ul> <li><code>model_dir</code> \u2014 timestamped checkpoints directory.</li> <li><code>best_model_dir</code> \u2014 promoted model location (used by both CLI and API).</li> </ul>"},{"location":"configuration/#example_3","title":"Example","text":"<pre><code>output:\n  model_dir: \"models\"\n  best_model_dir: \"models/best_model\"\n</code></pre>"},{"location":"configuration/#configuration-best-practices","title":"Configuration Best Practices","text":"<p>Override Values</p> <p>Adjust paths to match your filesystem before first run. Override individual values on the CLI by editing the YAML or programmatically modifying the config dict before passing it into the pipeline.</p> <p>Path Resolution</p> <p>Ensure relative paths resolve from the repository root. All paths in the configuration are relative to the project root directory.</p> <p>API Configuration</p> <p>The API automatically loads <code>models/best_model/</code>. Do not point the API to a different location without updating the YAML.</p>"},{"location":"deployment/","title":"Documentation Deployment","text":"<p>This guide explains how to build and deploy the documentation website.</p>"},{"location":"deployment/#local-development","title":"Local Development","text":""},{"location":"deployment/#install-documentation-dependencies","title":"Install Documentation Dependencies","text":"<pre><code>pip install -r requirements-docs.txt\n</code></pre>"},{"location":"deployment/#build-documentation-locally","title":"Build Documentation Locally","text":"<pre><code>mkdocs build\n</code></pre> <p>This creates a <code>site/</code> directory with the static HTML files.</p>"},{"location":"deployment/#serve-documentation-locally","title":"Serve Documentation Locally","text":"<pre><code>mkdocs serve\n</code></pre> <p>Then visit <code>http://127.0.0.1:8000</code> in your browser. The site will automatically reload when you save changes to the documentation files.</p>"},{"location":"deployment/#preview-options","title":"Preview Options","text":"<ul> <li><code>mkdocs serve</code> \u2014 Run local development server with auto-reload</li> <li><code>mkdocs serve -a 0.0.0.0:8080</code> \u2014 Serve on a different host/port</li> <li><code>mkdocs build --clean</code> \u2014 Clean build (removes previous site/ directory)</li> </ul>"},{"location":"deployment/#github-pages-deployment","title":"GitHub Pages Deployment","text":"<p>The documentation is automatically deployed to GitHub Pages when changes are pushed to the <code>main</code> branch.</p>"},{"location":"deployment/#automatic-deployment","title":"Automatic Deployment","text":"<p>The repository includes a GitHub Actions workflow (<code>.github/workflows/deploy-docs.yml</code>) that:</p> <ol> <li>Triggers on every push to <code>main</code></li> <li>Installs MkDocs and dependencies</li> <li>Builds the documentation</li> <li>Deploys to the <code>gh-pages</code> branch</li> </ol>"},{"location":"deployment/#enable-github-pages","title":"Enable GitHub Pages","text":"<p>To enable GitHub Pages for the first time:</p> <ol> <li>Go to your repository on GitHub</li> <li>Navigate to Settings \u2192 Pages</li> <li>Under Source, select Deploy from a branch</li> <li>Select the gh-pages branch and / (root) folder</li> <li>Click Save</li> </ol> <p>After the first deployment, your documentation will be available at:</p> <pre><code>https://gianaguilar.github.io/isco_pipeline/\n</code></pre>"},{"location":"deployment/#manual-deployment","title":"Manual Deployment","text":"<p>You can also deploy manually from your local machine:</p> <pre><code>mkdocs gh-deploy\n</code></pre> <p>This command: - Builds the documentation - Pushes the <code>site/</code> contents to the <code>gh-pages</code> branch - Updates GitHub Pages</p> <p>Repository Permissions</p> <p>Manual deployment requires push access to the repository and the ability to create/update the <code>gh-pages</code> branch.</p>"},{"location":"deployment/#deployment-workflow","title":"Deployment Workflow","text":"<pre><code>graph LR\n    A[Push to main] --&gt; B[GitHub Actions Trigger]\n    B --&gt; C[Install Dependencies]\n    C --&gt; D[Build with MkDocs]\n    D --&gt; E[Deploy to gh-pages]\n    E --&gt; F[GitHub Pages Update]\n    F --&gt; G[Live Documentation]\n</code></pre>"},{"location":"deployment/#customizing-the-documentation","title":"Customizing the Documentation","text":""},{"location":"deployment/#site-configuration","title":"Site Configuration","text":"<p>Edit <code>mkdocs.yml</code> to customize:</p> <ul> <li>Site metadata \u2014 name, description, author</li> <li>Theme settings \u2014 colors, fonts, features</li> <li>Navigation structure \u2014 add/remove/reorder pages</li> <li>Markdown extensions \u2014 code highlighting, admonitions, etc.</li> </ul>"},{"location":"deployment/#adding-new-pages","title":"Adding New Pages","text":"<ol> <li>Create a new <code>.md</code> file in the <code>docs/</code> directory</li> <li>Add the page to the <code>nav</code> section in <code>mkdocs.yml</code>:</li> </ol> <pre><code>nav:\n  - Home: index.md\n  - User Guide: users.md\n  - Developer Guide: developers.md\n  - API Reference: api.md\n  - Configuration: configuration.md\n  - Your New Page: new-page.md  # Add here\n</code></pre> <ol> <li>Commit and push \u2014 the page will be automatically deployed</li> </ol>"},{"location":"deployment/#styling-and-theming","title":"Styling and Theming","text":"<p>The documentation uses the Material for MkDocs theme.</p> <p>Customize colors in <code>mkdocs.yml</code>:</p> <pre><code>theme:\n  palette:\n    primary: indigo  # Change primary color\n    accent: indigo   # Change accent color\n</code></pre> <p>Available colors: red, pink, purple, deep purple, indigo, blue, light blue, cyan, teal, green, light green, lime, yellow, amber, orange, deep orange</p>"},{"location":"deployment/#troubleshooting","title":"Troubleshooting","text":""},{"location":"deployment/#build-failures","title":"Build Failures","text":"<p>If the documentation fails to build:</p> <ol> <li>Check the GitHub Actions log in the Actions tab</li> <li>Run <code>mkdocs build</code> locally to see detailed error messages</li> <li>Common issues:</li> <li>Broken internal links</li> <li>Invalid YAML in <code>mkdocs.yml</code></li> <li>Missing dependencies</li> </ol>"},{"location":"deployment/#local-preview-issues","title":"Local Preview Issues","text":"<p>If <code>mkdocs serve</code> doesn't work:</p> <ul> <li>Ensure dependencies are installed: <code>pip install -r requirements-docs.txt</code></li> <li>Check for port conflicts (default is 8000)</li> <li>Try <code>mkdocs serve -a 127.0.0.1:8001</code> to use a different port</li> </ul>"},{"location":"deployment/#deployment-not-updating","title":"Deployment Not Updating","text":"<p>If changes don't appear on GitHub Pages:</p> <ol> <li>Check that the workflow ran successfully in Actions</li> <li>Verify GitHub Pages is enabled in repository settings</li> <li>Wait a few minutes \u2014 GitHub Pages can take time to update</li> <li>Clear your browser cache or try incognito mode</li> <li>Check that <code>gh-pages</code> branch exists and has recent commits</li> </ol>"},{"location":"deployment/#cicd-integration","title":"CI/CD Integration","text":"<p>The documentation deployment is integrated with your CI/CD pipeline:</p> <ul> <li>Automatic \u2014 Every push to <code>main</code> updates the docs</li> <li>Manual \u2014 Use <code>workflow_dispatch</code> to trigger deployment manually</li> <li>Permissions \u2014 The workflow has <code>contents: write</code> permission</li> </ul>"},{"location":"deployment/#trigger-manual-deployment","title":"Trigger Manual Deployment","text":"<ol> <li>Go to Actions tab on GitHub</li> <li>Select Deploy Documentation workflow</li> <li>Click Run workflow</li> <li>Select <code>main</code> branch</li> <li>Click Run workflow button</li> </ol>"},{"location":"deployment/#best-practices","title":"Best Practices","text":"<p>Documentation-Driven Development</p> <p>Update documentation alongside code changes. Keep the docs in sync with your implementation.</p> <p>Test Locally First</p> <p>Always run <code>mkdocs serve</code> locally to preview changes before pushing.</p> <p>Write Clear Examples</p> <p>Include code examples, command outputs, and real-world use cases in your documentation.</p> <p>Keep Navigation Simple</p> <p>Don't nest too deeply \u2014 aim for 2-3 levels maximum in the navigation structure.</p>"},{"location":"developers/","title":"Developer Guide","text":""},{"location":"developers/#1-architecture-snapshot","title":"1. Architecture Snapshot","text":"<ul> <li><code>main.py</code> orchestrates preprocessing \u2192 training \u2192 prediction \u2192 evaluation. Each stage delegates to <code>src/</code> modules.</li> <li>Preprocessing (<code>src/preprocess.py</code>) normalises text via <code>clean_and_combine_text</code>; reuse this helper for any new ingestion path.</li> <li>Training (<code>src/model.py</code>) uses Hugging Face <code>Trainer</code>/<code>TrainingArguments</code> with optional MPS optimisations and promotes the best model by comparing <code>eval_loss</code> against <code>models/best_model/metrics.json</code>.</li> <li>Inference (<code>src/predict.py</code> and <code>api/prediction_service.py</code>) loads the promoted model, applies a keyed LRU cache, and respects <code>model.max_seq_length</code> and <code>model.confidence_threshold</code> from <code>config.yaml</code>.</li> </ul>"},{"location":"developers/#2-local-development-workflow","title":"2. Local Development Workflow","text":"<ol> <li>Sync dependencies: <code>pip install -r requirements.txt</code> (use editable installs for local packages if needed).</li> <li>Use <code>python main.py --config config.yaml --skip-training</code> to validate preprocessing/evaluation changes without retraining.</li> <li>For API changes, run <code>python api_server.py</code> and exercise endpoints using the Swagger UI or <code>curl</code>.</li> <li>Keep large intermediate data out of git; working files should live under <code>data/</code> or <code>tmp_trainer/</code>.</li> </ol>"},{"location":"developers/#3-coding-practices","title":"3. Coding Practices","text":"<ul> <li>Stick to PEP 8 with 4-space indentation; prefer descriptive names and module-level constants over magic numbers.</li> <li>Route all logging through the shared logger; avoid print statements so output lands in both console and rotating log files.</li> <li>Avoid duplicating configuration: read from <code>config.yaml</code> via helpers in <code>src/utils.py</code> and propagate values through function parameters instead of globals.</li> <li>When introducing new preprocessing or prediction logic, ensure the CLI and API paths both call the same helper to keep behaviour aligned.</li> </ul>"},{"location":"developers/#4-testing-verification","title":"4. Testing &amp; Verification","text":"<ul> <li>Add <code>pytest</code> suites under <code>tests/</code>; mock heavy transformers components to keep runs quick.</li> <li>Prioritise regression coverage for: text formatting helpers, prediction caching, attention-based explanation generation, and API batch handlers.</li> <li>Before opening a PR, run targeted scripts (<code>python -m py_compile &lt;module&gt;</code> or lightweight smoke runs) and note the results in the PR description. Full end-to-end training is optional unless core training code changed.</li> </ul>"},{"location":"developers/#5-known-gaps-todos","title":"5. Known Gaps / TODOs","text":"<ul> <li>Replace interactive <code>input()</code> prompts in <code>src/preprocess.py</code> and <code>src/model.py</code> with config-driven behaviour for non-TTY environments.</li> <li>Revisit the very low default <code>model.confidence_threshold</code> once business requirements are clarified.</li> <li>Add automated tests for the attention-based explanation pipeline and the API CSV upload route.</li> </ul>"},{"location":"developers/#6-configuration-cheat-sheet","title":"6. Configuration Cheat Sheet","text":"<ul> <li>Access configuration via <code>src.utils.load_config</code>; keep overrides explicit to aid reproducibility.</li> <li>Common keys and their downstream consumers:</li> <li><code>data</code> \u279c preprocessing, evaluation, and API reference lookups. Ensure relative paths resolve from the repository root.</li> <li><code>model.name</code> \u279c passed to Hugging Face initialisation; updating requires compatible tokenizers and possibly retraining checkpoints.</li> <li><code>model.max_seq_length</code> \u279c shared between <code>prepare_datasets</code> and API tokenisation. Changes necessitate reprocessing training data.</li> <li><code>training.enable_optimizations</code> \u279c toggles gradient checkpointing and fp16 (CUDA only). On Apple Silicon only the MPS-specific toggles apply.</li> <li><code>training.early_stopping_patience</code> \u279c automatically enables <code>load_best_model_at_end</code> in <code>TrainingArguments</code>.</li> <li><code>output.best_model_dir</code> \u279c single source of truth for inference; do not point the API to a different location without updating the YAML.</li> </ul>"},{"location":"developers/#7-training-evaluation-flow","title":"7. Training &amp; Evaluation Flow","text":"<ul> <li><code>train_model</code> constructs <code>TrainingArguments</code> using the config values, applies Apple Silicon optimisations when available, and records elapsed time for observability.</li> <li>Post-training, <code>save_best_model</code> promotes the run if <code>eval_loss</code> improved; metrics and mappings are written alongside the weights for traceability.</li> <li>CLI evaluation (<code>evaluate_model(config)</code>) reloads processed validation/test splits, reports aggregate metrics, and can be invoked independently by running <code>python main.py --skip-training</code>.</li> <li>When experimenting with hyperparameters, favour timestamped checkpoints in <code>models/</code> for forensic analysis; only copy artifacts into <code>best_model_dir</code> once they outperform the incumbent.</li> </ul>"},{"location":"users/","title":"User Guide","text":""},{"location":"users/#1-environment-setup","title":"1. Environment Setup","text":"<ul> <li>Requires Python 3.10+ and git.</li> <li>Create a virtual environment and install requirements:   <pre><code>python -m venv venv &amp;&amp; source venv/bin/activate\npip install -r requirements.txt\n</code></pre></li> <li>Update <code>config.yaml</code> paths if your data lives outside the repository.</li> </ul>"},{"location":"users/#2-running-the-cli-pipeline","title":"2. Running the CLI Pipeline","text":"<ul> <li>Train from scratch <pre><code>python main.py --config config.yaml\n</code></pre>   Generates processed splits under <code>data/processed/</code>, saves checkpoints in <code>models/</code>, and writes run logs to <code>logs/</code>.</li> <li>Reuse the latest promoted model <pre><code>python main.py --skip-training --input &lt;path/to/jobs.csv&gt;\n</code></pre>   Input CSV must contain <code>job_title</code> and <code>duties_description</code>. Results are written to <code>data/processed/predictions_&lt;DATE&gt;.csv</code>, leaving the source file unchanged.</li> <li>Optional flags</li> <li><code>--explain</code> adds attention-based explanation HTML alongside predictions.</li> <li><code>--force-update-best</code> overrides metric checks and replaces <code>models/best_model/</code> with the newly trained weights.</li> </ul>"},{"location":"users/#3-fastapi-service","title":"3. FastAPI Service","text":"<ul> <li>Start the API with:   <pre><code>python api_server.py\n</code></pre>   Visit <code>http://localhost:8000/docs</code> for interactive endpoints.</li> <li>Key endpoints:</li> <li><code>POST /predict/job</code> \u2014 single JSON payload with <code>job_title</code> and <code>duties_description</code>.</li> <li><code>POST /predict/batch</code> \u2014 send <code>{ \"jobs\": [ ... ] }</code> to classify multiple records in one call.</li> <li><code>POST /predict/csv</code> \u2014 upload a CSV; receive a CSV with predictions.</li> <li>The service automatically loads <code>models/best_model/</code> and caches the artifacts in memory.</li> </ul>"},{"location":"users/#4-artefact-management","title":"4. Artefact Management","text":"<ul> <li>Best-performing weights live in <code>models/best_model/</code> and are consumed by both the CLI and API.</li> <li>Timestamped checkpoints for each training run are preserved under <code>models/checkpoint-final-*/</code>.</li> <li>Reference mappings and metadata are stored beside the model for portability (<code>label2id.json</code>, <code>code_metadata.json</code>, <code>metrics.json</code>).</li> </ul>"},{"location":"users/#5-troubleshooting","title":"5. Troubleshooting","text":"<ul> <li>If the dataset exceeds ~50k rows, the CLI warns about runtime cost and defaults to the full dataset when run non-interactively.</li> <li>Predictions rely on <code>data/reference/isco08_reference.csv</code>; ensure the file remains in sync with your label set.</li> <li>For low-confidence outputs (&lt; <code>model.confidence_threshold</code>), expect the <code>is_fallback</code> flag to be <code>true</code>; adjust the threshold in <code>config.yaml</code> to tune behaviour.</li> </ul>"},{"location":"users/#6-configuration-reference","title":"6. Configuration Reference","text":"<ul> <li>Data block</li> <li><code>raw_dir</code>: where the unprocessed CSVs live (input to preprocessing).</li> <li><code>processed_dir</code>: destination for generated <code>train.csv</code>, <code>val.csv</code>, and <code>test.csv</code> splits.</li> <li><code>reference_file</code>: canonical ISCO lookup used for validation and human-readable labels.</li> <li><code>skip_clustering</code>, <code>skip_clustering_threshold</code>: disable embedding clustering entirely or only when the dataset exceeds the threshold.</li> <li>Model block</li> <li><code>max_seq_length</code>: token limit for RoBERTa; the service truncates any longer inputs.</li> <li><code>confidence_threshold</code>: probability cut-off controlling when a prediction is accepted versus marked as fallback.</li> <li><code>four_digit_only</code>: restrict predictions to 4-digit ISCO codes; set <code>false</code> to allow broader code levels.</li> <li>Training block</li> <li><code>gradient_accumulation_steps</code>: effective batch multiplier (increase for limited GPU/VRAM).</li> <li><code>warmup_steps</code>, <code>weight_decay</code>, <code>learning_rate</code>: standard optimisation knobs; adjust carefully and log changes.</li> <li><code>early_stopping_patience</code>: number of evaluation rounds without improvement before training stops.</li> <li><code>force_update_best</code> (optional): when true, promotes the latest model even if metrics regress.</li> <li>Output block</li> <li><code>model_dir</code>: parent directory for timestamped checkpoints after each run.</li> <li><code>best_model_dir</code>: canonical location used by inference; do not delete unless resetting the service.</li> </ul>"},{"location":"users/#7-training-evaluation-details","title":"7. Training &amp; Evaluation Details","text":"<ul> <li>During training the pipeline logs metrics every <code>logging_steps</code> updates and evaluates according to <code>evaluation_strategy</code> (default per epoch).</li> <li>Early stopping is active when <code>early_stopping_patience &gt; 0</code>; the trainer tracks <code>eval_loss</code> and halts once the metric plateaus.</li> <li>After training completes, the helper compares the best <code>eval_loss</code> against <code>models/best_model/metrics.json</code> and only replaces the promoted model if the new run is better (unless forced via CLI or config).</li> <li>Evaluation (<code>python main.py --skip-training</code>) loads the promoted model and reports accuracy, 3-digit accuracy, macro F1, and top-3 accuracy in both the console and the timestamped log file.</li> <li>Check the latest log in <code>logs/</code> for full metric history, runtime durations, and any warnings about class imbalance or missing labels.</li> </ul>"}]}